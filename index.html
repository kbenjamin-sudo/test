<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>StudyOS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- WebLLM -->
<script src="https://unpkg.com/@mlc-ai/web-llm/dist/index.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');

:root {
  --bg: #0a0a0f;
  --panel: rgba(255,255,255,0.05);
  --border: rgba(255,255,255,0.12);
  --text: #eaeaf0;
  --muted: #9aa0b3;
  --accent: #7c7cff;
  --blur: blur(18px);
}

* {
  box-sizing: border-box;
  font-family: Inter, system-ui, sans-serif;
}

body {
  margin: 0;
  height: 100vh;
  display: grid;
  grid-template-columns: 260px 1fr;
  background:
    radial-gradient(1200px 600px at top left, #1b1b3a, transparent),
    radial-gradient(800px 400px at bottom right, #2a2a5a, transparent),
    var(--bg);
  color: var(--text);
}

/* SIDEBAR */
aside {
  padding: 22px;
  backdrop-filter: var(--blur);
  background: var(--panel);
  border-right: 1px solid var(--border);
}

aside h1 {
  font-weight: 600;
  letter-spacing: .4px;
  margin-bottom: 24px;
}

nav button {
  width: 100%;
  padding: 12px;
  margin-bottom: 8px;
  background: transparent;
  color: var(--text);
  border: none;
  border-radius: 10px;
  cursor: pointer;
  text-align: left;
}

nav button.active,
nav button:hover {
  background: rgba(124,124,255,.15);
}

/* MAIN */
main {
  padding: 28px;
  overflow-y: auto;
}

section {
  display: none;
}

section.active {
  display: block;
}

.panel {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 18px;
  margin-bottom: 18px;
  backdrop-filter: var(--blur);
}

textarea, input {
  width: 100%;
  background: transparent;
  border: none;
  color: var(--text);
  resize: none;
  outline: none;
  font-size: 15px;
}

textarea::placeholder,
input::placeholder {
  color: var(--muted);
}

button.primary {
  background: linear-gradient(135deg, #7c7cff, #9f9fff);
  color: black;
  border: none;
  padding: 10px 16px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
}

/* FLASHCARD */
.flashcard {
  min-height: 160px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  text-align: center;
  cursor: pointer;
}

/* QUIZ */
.quiz-q {
  margin-bottom: 12px;
}

/* PRINT */
@media print {
  body {
    background: white;
    color: black;
  }
  aside {
    display: none;
  }
}
</style>
</head>

<body>

<aside>
  <h1>StudyOS</h1>
  <nav>
    <button class="active" onclick="show('notes')">Study Sheets</button>
    <button onclick="show('flash')">Flashcards</button>
    <button onclick="show('quiz')">AI Quizzes</button>
    <button onclick="exportPDF()">Export PDF</button>
  </nav>
</aside>

<main>

<!-- NOTES -->
<section id="notes" class="active">
  <h2>Study Sheets</h2>
  <div class="panel">
    <textarea id="notes" rows="18" placeholder="Write beautiful, printable notes..."></textarea>
  </div>
</section>

<!-- FLASHCARDS -->
<section id="flash">
  <h2>Flashcards</h2>
  <div class="panel">
    <input id="fq" placeholder="Question">
    <input id="fa" placeholder="Answer">
    <button class="primary" onclick="addCard()">Add</button>
  </div>
  <div id="card" class="panel flashcard" onclick="flip()">Tap to study</div>
</section>

<!-- QUIZ -->
<section id="quiz">
  <h2>AI Quiz Generator (Local)</h2>
  <div class="panel">
    <textarea id="topic" placeholder="Topic (e.g. Neural Networks backpropagation)"></textarea>
    <button class="primary" onclick="makeQuiz()">Generate Quiz</button>
  </div>
  <div id="quizOut"></div>
</section>

</main>

<script>
/* NAV */
function show(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

/* NOTES SAVE */
notes.value = localStorage.notes || "";
notes.oninput = () => localStorage.notes = notes.value;

/* PDF EXPORT */
function exportPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.text(notes.value, 10, 10, { maxWidth: 180 });
  pdf.save("study-notes.pdf");
}

/* FLASHCARDS */
let cards = JSON.parse(localStorage.cards || "[]");
let i = 0, flipped=false;

function addCard(){
  cards.push({q:fq.value,a:fa.value});
  localStorage.cards = JSON.stringify(cards);
  fq.value = fa.value = "";
}

function flip(){
  if(!cards.length) return;
  flipped=!flipped;
  card.innerText = flipped ? cards[i].a : cards[i].q;
}

setInterval(()=>{
  if(!cards.length) return;
  flipped=false;
  i=(i+1)%cards.length;
  card.innerText=cards[i].q;
},5000);

/* LOCAL AI QUIZ */
let engine;

async function loadAI(){
  engine = await webllm.createEngine("Llama-3-8B-Instruct-q4f32_1");
}

loadAI();

async function makeQuiz(){
  quizOut.innerHTML="Thinking...";
  const prompt = `
Create a 5-question study quiz on:
${topic.value}

Include:
- 3 multiple choice
- 2 short answer
`;

  const reply = await engine.chat.completions.create({
    messages: [{ role: "user", content: prompt }]
  });

  quizOut.innerHTML = `
    <div class="panel">
      ${reply.choices[0].message.content.replace(/\n/g,"<br>")}
    </div>`;
}
</script>

</body>
</html>
