<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyOS | Cloud</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script type="module" src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');

    :root {
        --bg: #030712; --panel: #111827; --surface: #1f2937;
        --border: #374151; --text: #f9fafb; --muted: #9ca3af;
        --accent: #6366f1; --accent-glow: rgba(99, 102, 241, 0.15);
        --danger: #ef4444;
    }

    * { box-sizing: border-box; font-family: 'Inter', sans-serif; outline: none; }
    
    body { 
        margin: 0; background: var(--bg); color: var(--text); 
        height: 100vh; overflow: hidden; display: flex; 
    }

    /* --- LOGIN MODAL (Glassmorphism) --- */
    #auth-overlay {
        position: fixed; inset: 0; background: rgba(3, 7, 18, 0.85); backdrop-filter: blur(12px);
        z-index: 999; display: flex; align-items: center; justify-content: center;
        transition: opacity 0.3s;
    }
    .auth-box {
        background: var(--panel); border: 1px solid var(--border); padding: 40px;
        border-radius: 24px; width: 360px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        text-align: center;
    }
    .auth-box h2 { margin: 0 0 20px 0; font-weight: 800; letter-spacing: -1px; }
    .input-group { margin-bottom: 15px; text-align: left; }
    .input-group label { display: block; color: var(--muted); font-size: 0.85rem; margin-bottom: 5px; }
    .auth-input {
        width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border);
        color: white; border-radius: 8px; transition: 0.2s;
    }
    .auth-input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }
    
    .btn-auth {
        width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 8px;
        background: var(--accent); color: white; font-weight: 600; cursor: pointer;
        transition: 0.2s;
    }
    .btn-auth:hover { filter: brightness(1.1); }
    .auth-link { margin-top: 15px; font-size: 0.9rem; color: var(--muted); cursor: pointer; }
    .auth-link:hover { color: var(--accent); }

    /* --- MAIN APP --- */
    aside {
        width: 280px; background: var(--panel); border-right: 1px solid var(--border);
        display: flex; flex-direction: column; padding: 20px;
    }
    .brand { font-size: 1.4rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 24px; color: white; }
    .brand span { color: var(--accent); }
    
    .note-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
    .note-card {
        padding: 12px 16px; border-radius: 10px; cursor: pointer; border: 1px solid transparent;
        transition: 0.2s; display: flex; justify-content: space-between; align-items: center;
        color: var(--muted);
    }
    .note-card:hover { background: var(--surface); color: var(--text); }
    .note-card.active { background: var(--surface); border-color: var(--border); color: var(--text); font-weight: 600; }
    .note-card.fav::after { content: '‚òÖ'; color: #fbbf24; }

    main { flex: 1; display: flex; flex-direction: column; position: relative; }
    
    .toolbar {
        padding: 15px 30px; border-bottom: 1px solid var(--border); display: flex; 
        justify-content: space-between; align-items: center; background: rgba(3, 7, 18, 0.5);
    }
    .status { font-size: 0.85rem; color: var(--muted); display: flex; align-items: center; gap: 6px; }
    .status.saved::before { content: ''; width: 8px; height: 8px; background: #10b981; border-radius: 50%; }
    .status.unsaved::before { content: ''; width: 8px; height: 8px; background: #fbbf24; border-radius: 50%; }

    .actions { display: flex; gap: 8px; }
    .btn {
        background: var(--surface); border: 1px solid var(--border); color: var(--text);
        padding: 8px 14px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500;
        transition: 0.2s; display: flex; align-items: center; gap: 6px;
    }
    .btn:hover { background: var(--border); }
    .btn-danger { color: var(--danger); border-color: rgba(239, 68, 68, 0.3); }
    .btn-danger:hover { background: rgba(239, 68, 68, 0.1); }
    
    .editor { flex: 1; padding: 40px; overflow-y: auto; max-width: 900px; margin: 0 auto; width: 100%; }
    #title-in {
        width: 100%; background: transparent; border: none; font-size: 2.5rem; 
        font-weight: 800; color: var(--text); margin-bottom: 20px;
    }
    #body-in {
        width: 100%; height: 70vh; background: transparent; border: none; 
        font-size: 1.15rem; line-height: 1.7; color: #d1d5db; resize: none;
    }
</style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-box">
        <h2>StudyOS<span style="color:var(--accent)">.</span></h2>
        <div class="input-group">
            <label>Email</label>
            <input type="email" id="email" class="auth-input" placeholder="student@example.com">
        </div>
        <div class="input-group">
            <label>Password</label>
            <input type="password" id="password" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button class="btn-auth" onclick="handleAuth()">Sign In</button>
        <div class="auth-link" onclick="toggleAuthMode()" id="auth-switch">New here? Create Account</div>
        <div id="auth-error" style="color: var(--danger); margin-top: 10px; font-size: 0.9rem;"></div>
    </div>
</div>

<aside>
    <div class="brand">StudyOS<span>.</span></div>
    <button class="btn" style="width:100%; justify-content:center; margin-bottom:20px; background:var(--accent); color:white; border:none" onclick="createNote()">+ New Note</button>
    <div class="note-list" id="list"></div>
    <div style="margin-top:auto; padding-top:20px; border-top:1px solid var(--border)">
        <button class="btn" style="width:100%" onclick="signOut()">Sign Out</button>
    </div>
</aside>

<main>
    <div class="toolbar">
        <div class="status unsaved" id="status">Unsaved</div>
        <div class="actions">
            <button class="btn" onclick="toggleFav()">‚≠ê Fav</button>
            <button class="btn" onclick="exportPDF()">üìÑ PDF</button>
            <button class="btn" onclick="saveNote()">üíæ Save</button>
            <button class="btn btn-danger" onclick="deleteNote()">üóëÔ∏è</button>
        </div>
    </div>
    <div class="editor">
        <input type="text" id="title-in" placeholder="Untitled Note...">
        <textarea id="body-in" placeholder="Start typing your study notes..."></textarea>
    </div>
</main>

<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // --- 1. CONFIGURATION (FILL THESE IN) ---
    const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
    const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';
    
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // --- 2. STATE ---
    let notes = [];
    let activeId = null;
    let isSignUp = false;
    let currentUser = null;

    // --- 3. AUTH LOGIC ---
    window.toggleAuthMode = () => {
        isSignUp = !isSignUp;
        document.querySelector('.btn-auth').innerText = isSignUp ? "Create Account" : "Sign In";
        document.getElementById('auth-switch').innerText = isSignUp ? "Have an account? Sign In" : "New here? Create Account";
    }

    window.handleAuth = async () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('auth-error');
        errorDiv.innerText = "";

        const { data, error } = isSignUp 
            ? await supabase.auth.signUp({ email, password })
            : await supabase.auth.signInWithPassword({ email, password });

        if (error) errorDiv.innerText = error.message;
        else if (isSignUp) alert("Check your email for the confirmation link!");
    }

    window.signOut = async () => await supabase.auth.signOut();

    // Listen for Auth Changes
    supabase.auth.onAuthStateChange((event, session) => {
        if (session) {
            currentUser = session.user;
            document.getElementById('auth-overlay').style.display = 'none';
            fetchNotes(); // Load data on login
        } else {
            document.getElementById('auth-overlay').style.display = 'flex';
            notes = []; renderList();
        }
    });

    // --- 4. NOTE LOGIC ---
    async function fetchNotes() {
        const { data, error } = await supabase.from('notes').select('*').order('updated_at', { ascending: false });
        if (data) { notes = data; renderList(); if(notes.length) loadNote(notes[0].id); }
    }

    window.createNote = async () => {
        const newNote = { user_id: currentUser.id, title: "", content: "" };
        const { data } = await supabase.from('notes').insert(newNote).select();
        if(data) { notes.unshift(data[0]); loadNote(data[0].id); renderList(); }
    }

    window.saveNote = async () => {
        if(!activeId) return;
        const title = document.getElementById('title-in').value;
        const content = document.getElementById('body-in').value;
        
        // Update Local
        const n = notes.find(n => n.id === activeId);
        n.title = title; n.content = content;
        
        // Update Cloud
        document.getElementById('status').className = "status unsaved";
        document.getElementById('status').innerText = "Syncing...";
        
        await supabase.from('notes').update({ title, content, updated_at: new Date() }).eq('id', activeId);
        
        document.getElementById('status').className = "status saved";
        document.getElementById('status').innerText = "Saved to Cloud";
        renderList();
    }

    window.deleteNote = async () => {
        if(!activeId || !confirm("Delete this note?")) return;
        await supabase.from('notes').delete().eq('id', activeId);
        notes = notes.filter(n => n.id !== activeId);
        if(notes.length) loadNote(notes[0].id);
        else { activeId = null; document.getElementById('title-in').value = ""; document.getElementById('body-in').value = ""; }
        renderList();
    }

    window.loadNote = (id) => {
        activeId = id;
        const n = notes.find(n => n.id === id);
        document.getElementById('title-in').value = n.title || "";
        document.getElementById('body-in').value = n.content || "";
        document.getElementById('status').innerText = "Ready";
        renderList();
    }

    window.toggleFav = async () => {
        if(!activeId) return;
        const n = notes.find(n => n.id === activeId);
        n.is_fav = !n.is_fav;
        await supabase.from('notes').update({ is_fav: n.is_fav }).eq('id', activeId);
        renderList();
    }

    function renderList() {
        const list = document.getElementById('list');
        list.innerHTML = notes.map(n => `
            <div class="note-card ${n.id === activeId ? 'active' : ''} ${n.is_fav ? 'fav' : ''}" 
                 onclick="loadNote('${n.id}')">
                ${n.title || 'Untitled Note'}
            </div>
        `).join('');
    }

    window.exportPDF = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(20); doc.text(document.getElementById('title-in').value, 20, 20);
        doc.setFontSize(12); doc.text(doc.splitTextToSize(document.getElementById('body-in').value, 170), 20, 40);
        doc.save("StudyOS_Note.pdf");
    }
</script>
</body>
</html>
